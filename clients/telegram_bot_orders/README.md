# Telegram Bot Orders

Телеграм-бот для оформления заказов через Regos. Обрабатывает подбор товаров по категориям, корзину, оформление заказа и взаимодействие с бонусными картами.

## Основные возможности

- Просмотр категорий и товаров с ценами и остатками (опционально).
- Управление корзиной: добавить, удалить, очистить.
- Отправка заказов в `DocOrderDelivery/AddFull` с указанием типа доставки, адреса и описания.
- Поддержка бонусных карт и генерация QR-изображений для них.
- Привязка клиента по номеру телефона и полю `field_telegram_id` (если поле доступно).
- Настраиваемые кнопки меню и текстовые сообщения.

## Настройки (ConnectedIntegrationSetting)

- `BOT_TOKEN` — токен Telegram-бота.
- `PRICE_TYPE_ID` — тип цены, используемый при запросе товаров.
- `STOCK_ID`, `STOCK_ID_QUANTITY` — склад и склад для остатков.
- `SHOW_ZERO_QUANTITY` — показывать товары с нулевым остатком.
- `SHOW_WITHOUT_IMAGES` — показывать товары без изображений.
- `SHOW_ITEMS_WITHOUT_PRICE` — показывать товары без цены; по умолчанию `false`.
- `SHOW_ITEM_STOCK` — показывать остатки в списке и карточке товара (по умолчанию `true`).
- `ORDER_SOURCE_ID` — источник заказа (`from_id`).
- `MIN_ORDER_AMOUNT` — минимально допустимая сумма заказа.
- `WORK_TIME_ENABLED`, `WORK_TIME_START`, `WORK_TIME_END` — рабочее время для приёма заказов.
- `CUSTOMER_GROUP_ID` — группа клиентов, необходимая при создании.
- `WELCOME_MESSAGE` — приветственное сообщение.
- `DELIVERY_TYPE_REQUIRED`, `ADDRESS_REQUIRED` — требовать тип доставки и адрес.
- `ITEM_GROUP_IDS` — ограничение по группам товаров.
- `CATALOG_PAGE_SIZE` — количество товаров на странице (по умолчанию 5).
- `ORDERS_DISABLED` — ограничить заказ на стороне бота.
- `ORDER_STATE_TTL` — время жизни состояния заказа (секунды).

## Telegram

В `config/settings.py` можно настроить режим приема обновлений:

- `telegram_update_mode = "webhook"` — webhook режим.
- `telegram_update_mode = "longpolling"` — longpolling режим.

## UX

- Меню построено с помощью `ReplyKeyboardMarkup`: разделы каталог, корзина, заказы, бонусные карты.
- При выборе категории пользователь видит список товаров с ценами и остатками (если включено).
- При клике на товар выводится карточка с дополнительными сведениями, изображением и доступными действиями.
- Корзина показывает текущие позиции, количество, цену и итог.

## Требования

- Redis (необязательно, используется для кеширования настроек, каталога и состояния).
- Пакеты `qrcode` и `Pillow` для генерации изображений бонусных карт (при отсутствии изображений используется текст).

